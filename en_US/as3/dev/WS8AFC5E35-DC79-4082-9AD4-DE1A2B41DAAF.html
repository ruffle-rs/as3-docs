<?xml version="1.0" encoding="UTF-8"?>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- saved from url=(0022)http://help.adobe.com/ -->
<!-- saved from url=(0022)http://help.adobe.com/ -->
<html lang="en-us">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
  <meta content="en-us" name="lang"/>
  <meta content="livedocs" name="area"/>
  <title>
   Adobe Flash Platform * Using encryption with SQL databases
  </title>
  <link href="https://help.adobe.com/en_US/as3/dev/images/FlashRuntimeLinkIndicator.png" rel="shortcut icon"/>
  <meta content="ActionScript 3.0 Developer’s Guide" name="book"/>
  <meta content="adobe" name="product"/>
  <meta content="air" name="product"/>
  <meta content="flash" name="product"/>
  <meta content="flex" name="product"/>
  <meta content="" name="keywords"/>
  <!--<PageMap><DataObject type="document"><Attribute name="product" value="adobe"></Attribute><Attribute name="product" value="air"></Attribute><Attribute name="product" value="flash"></Attribute><Attribute name="product" value="flex"></Attribute><Attribute name="book" value="ActionScript 3.0 Developer’s Guide"></Attribute><Attribute name="keywords" value=""></Attribute></DataObject></PageMap>-->
  <script charset="UTF-8" language="Javascript" type="text/javascript">
   <!--[CDATA[
        var currentTreeNode = "WS8AFC5E35-DC79-4082-9AD4-DE1A2B41DAAF.html";
// ]]-->
  </script>
  <script charset="UTF-8" language="Javascript" src="terms.js" type="text/javascript">
   ...
  </script>
  <script charset="UTF-8" language="Javascript" src="help.js" type="text/javascript">
   ...
  </script>
  <script charset="UTF-8" language="Javascript" src="utilities.js" type="text/javascript">
   ...
  </script>
  <script charset="UTF-8" language="Javascript" src="event.js" type="text/javascript">
   ...
  </script>
  <script charset="UTF-8" language="Javascript" src="treeview.js" type="text/javascript">
   ...
  </script>
  <script charset="UTF-8" language="Javascript" src="toc.js" type="text/javascript">
   ..
  </script>
  <script charset="UTF-8" language="Javascript" src="swfobject.js" type="text/javascript">
   ..
  </script>
  <script charset="UTF-8" language="Javascript" src="booklist.js" type="text/javascript">
   ..
  </script>
  <script type="text/javascript">
   <!--[CDATA[
var topictype = "topic";
var headId = document.getElementsByTagName("head")[0];         
if (use_ie_6_behavior) {
  var linkId = document.createElement("link");
  linkId.href = "content-ie6.css";
  linkId.rel = "stylesheet";
  linkId.type = "text/css";
  headId.appendChild(linkId);
}
function initRoboHelpDOM() {
  if (use_chm_behavior) {
    hideElement("search");
  }
  if (use_robohelp_behavior) {
    hideElement("search");
    hideElement("productmenu");
    //hideElement("notyourversion");
  }
  if(!use_chc_behavior) {
    //document.getElementById("notyourversion").style.display = "inline";;
  }
}
var dirname = location.pathname.match( /.*\// );    
function setSearchUserPref(){
  if ( document.cookie.indexOf( "ah_searchpref" ) > -1 ) {
    if ( document.cookie.indexOf( dirname ) > 0 ) {
      document.search.gsa.checked = true ;
    }else{
      document.search.gsa.checked = false ;            
    }
  }
}
YAHOO.util.Event.onDOMReady(initRoboHelpDOM);
YAHOO.util.Event.onDOMReady(setSearchUserPref);
// ]]-->
  </script>
  
<!-- ********************************** -->
<!-- START: ForeSee survey code in: /ssi/globalheader.ssi -->

<script type="text/javascript">
<!-- 
// Enable the survey for only English, German and Japanese
var agt=navigator.userAgent.toLowerCase();
if ( agt.indexOf("community help client") == -1 ){
    if ( document.location.href.indexOf("/en_US/") != -1 ){
        showSurvey();
//    }else if (document.location.href.indexOf("/de_DE/") != -1){
//         var locale="de";
//         showSurvey();
    }else if (document.location.href.indexOf("/ja_JP/") != -1 ){
         var locale="ja";
         showSurvey();
    }	
}

function showSurvey(){
	//document.write('<script type="text/javascript" src="/js/foresee/foresee-trigger.js"><\/scr'+'ipt>');
    // DO NOTHING
}

// -->
</script>

<!-- END: ForeSee survey code -->
<!-- ******************************** -->


  
  
  <link href="tree.css" rel="stylesheet" type="text/css"/>
  <link href="content.css" rel="stylesheet" type="text/css"/>
  <link href="localeSpecific.css" rel="stylesheet" type="text/css"/>
 </head>
 <body id="content_body" onload="window.focus();">
  <a name="top" shape="rect">
   <!--LeaveCommentHere-->
  </a>
  <div id="mnemonic">
   <!--googleoff: index-->
   <div class="FlashRuntime" xmlns:adobe="http://www.adobe.com/saxon">
    <div class="banner">
     <a href="WS9936fa0d5984e93b3f4f38ec1272a447844-8000.html">
      Adobe Flash Platform
     </a>
    </div>
   </div>
   <!--googleon: index-->
  </div>
  <div id="searchbar">
   <table id="searchbartable">
    <tr>
     <td colspan="2">
      <!--googleoff: index-->
      <div xmlns:adobe="http://www.adobe.com/saxon">
       <div id="pdf">
        <img height="16" src="images/PDF.gif" width="16"/>
        <a href="as3_devguide.pdf" title="View Help PDF">
         View Help PDF (
          18M
         B)
        </a>
       </div>
      </div>
      <!--googleon: index-->
     </td>
    </tr>
   </table>
  </div>
  <!-- BEGIN SEARCH CONTENT -->
  <form action="https://help.adobe.com/en_US/as3/dev/search.html" id="search" name="search" target="_self">
   <script type="text/javascript">
    <!--[CDATA[
if ( !use_chc_behavior ){
    if (typeof(terms_AHV_SEARCH_CONSTRAINT) != "undefined" && 
        terms_AHV_SEARCH_CONSTRAINT.length > 0 && 
        document.location.href.indexOf(".adobe.com") > 0){
        if ( typeof(terms_SEARCH_THIS_HELP_ONLY) != "undefined" && terms_SEARCH_THIS_HELP_ONLY == "ON" ) {
            document.write('<div id="searchscope"> \
                <input onchange="setAHSearchPref();" \
                class="gsa" \
                name="gsa" \
                id="gsa" \
                type="checkbox" \
                checked="checked" \
                value="1" ><\/input>'); 
                
        // Leave the "Search this help system only" checkbox unckecked
        }else{    
            document.write('<div id="searchscope"> \
                <input onchange="setAHSearchPref();" \
                class="gsa" \
                name="gsa" \
                id="gsa" \
                type="checkbox" \
                value="1" ><\/input>'); 
        }
        document.write('<span class="gsalabel">' + terms_AHV_SEARCH_CONSTRAINT + '<\/span><\/div>'); 
    }
    document.write('<input class="searchinput" \
        name="q" \
        id="q" \
        type="text" \
        maxlength="256" \
        value="' + terms_AHV_SEARCH_BUTTON + '" \
        onclick="clearSearch()"><\/input><input \
        type="button" \
        name="searchbutton" \
        class="searchbutton" \
        onclick="submit()"><\/input>'); 
} 
 
/* 
 * Start Functions 
 */
function clearSearch(){
    if (document.search.q.value == terms_AHV_SEARCH_BUTTON){document.search.q.value = ""}; 
}

// set search preferences
function setAHSearchPref(){
    if (document.search.gsa.checked == 1){
        setAHSearchCookie( dirname );
    }else{
        setAHSearchCookie( "community" );
    }
}

// Set search preferences cookie
function setAHSearchCookie( p ){
    // set cookie ah_searchpref with a value of the document path
    var expire=new Date();
    expire.setDate(expire.getDate()+365); // Cookie expires after 1 year (365 days) 
}

// ]]-->
   </script>
  </form>
  <!-- END SEARCH CONTENT -->
  <!-- BEGIN PAGE CONTENT WRAPPER -->
  <div id="page_content_wrapper">
   <!-- BEGIN PAGE WRAPPER -->
   <table id="page_content_table">
    <tr>
     
     <td id="col2">
      <!-- BEGIN CONTENT WRAPPER -->
      <!-- BEGIN BREADCRUMBS -->
      <div id="breadcrumb">
       <ul class="navigation">
        <li class="prev">
         <a accesskey="p" class="prev" href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d2b.html" title="Understanding the asynchronous execution model">
          <img alt="Previous" height="17" src="images/blank.gif" width="17"/>
         </a>
        </li>
        <li class="next">
         <a accesskey="n" class="next" href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d25.html" title="Strategies for working with SQL databases">
          <img alt="Next" height="17" src="images/blank.gif" width="17"/>
         </a>
        </li>
       </ul>
       <div class="hierarchy" id="hierarchy">
        <a href="WS9936fa0d5984e93b3f4f38ec1272a447844-8000.html">
         <b>
          Home
         </b>
        </a>
        /
        <a href="WS9936fa0d5984e93b3f4f38ec1272a447844-8000.html">
         <b>
          ActionScript 3.0 Developer’s Guide
         </b>
        </a>
        /
        <a href="WSd75bf4610ec9e22f-26f30d3c12213ec4d50-8000.html">
         <b>
          Files and data
         </b>
        </a>
        /
        <a href="WS5b3ccc516d4fbf351e63e3d118676a5497-7fb4.html">
         <b>
          Working with local SQL databases in AIR
         </b>
        </a>
       </div>
      </div>
      <!-- END BREADCRUMBS -->
      <div id="content_wrapper">
       <!-- BEGIN PAGE TITLE -->
       <h1>
        Using encryption with SQL databases
       </h1>
       <p class="adoberuntime">
        Adobe AIR 1.5 and later
       </p>
       <!-- END PAGE TITLE -->
       <!-- BEGIN IONCOMMENTCOUNT -->
       <div id="ionCount">
       </div>
       <!-- END IONCOMMENTCOUNT -->
       <table border="0" cellpadding="0" cellspacing="0" id="inner_content_table" width="100%">
        <tr>
         <td>
          <div style="border-top:#ccc solid 1px;">
           <p>
           </p>
          </div>
          <p id="chcPromo" style="display:none;">
<a id="chcLink" href="http://www.adobe.com/support/chc/">
<img id="chcImage" src="http://www.adobe.com/support/chc/GetMoreHelpFeatures.png"/>
</a>
</p>
<script type="text/javascript" language="javascript" charset="utf-8">
<!--
var cfgArray = [];
//cfgArray["Acrobat_10.0_Professional.helpcfg"] = "acrobatpro";
//cfgArray["Acrobat_10.0_Standard.helpcfg"] = "acrobatstd";
cfgArray["Lightroom_3.0.helpcfg"] = "lightroom";
cfgArray["PhotoshopElements_8.0_Win.helpcfg"] = "photoshopelements";
cfgArray["PhotoshopElements_8.0_Mac.helpcfg"] = "photoshopelementsmac";
cfgArray["PremiereElements_8.0_Win.helpcfg"] = "premiereelements";

//cfgArray["AfterEffects_10.0.helpcfg"] = "aftereffects";
//cfgArray["AIR.helpcfg"] = "air";
//cfgArray["ColdFusionBuilder.helpcfg"] = "coldfusion";
//cfgArray["Contribute_6.0.helpcfg"] = "contribute";
//cfgArray["DeviceCentral_3.0.helpcfg"] = "devicecentral";
//cfgArray["Dreamweaver_11.0.helpcfg"] = "dreamweaver";
//cfgArray["EncoreDVD_5.0.helpcfg"] = "encore";
//cfgArray["ExtensionManager_3.0.helpcfg"] = "extension";
//cfgArray["Fireworks_11.0.helpcfg"] = "fireworks";
//cfgArray["Flash_11.0.helpcfg"] = "flash";
//cfgArray["Flex_4.0.helpcfg"] = "flashbuilder";
//cfgArray["FlashCatalyst_1.0.helpcfg"] = "flashcatalyst";
//cfgArray["Illustrator_15.0.helpcfg"] = "illustrator";
//cfgArray["InCopy_7.0.helpcfg"] = "incopy";
//cfgArray["InDesign_7.0.helpcfg"] = "indesign";
//cfgArray["OnLocation_5.0.helpcfg"] = "onlocation";
//cfgArray["Photoshop_12.0.helpcfg"] = "photoshop";
//cfgArray["PremierePro_5.0.helpcfg"] = "premierepro";

function getLangName() {
    var lang = "en-us";
    var metaElements = document.all ?
            document.all.tags('meta') :
            document.getElementsByTagName ?
            document.getElementsByTagName ('meta') : new Array();
    for (var m = 0; m < metaElements.length; m++) {
        if (metaElements[m].name == "lang") {
            lang = metaElements[m].content;
            break;
        }
    }
    var ptn = /(..)-(..)/;
    if (ptn.test(lang)) {
        var languageCode = lang.replace(ptn, "$1");
        var countryCode = lang.replace(ptn, "$2");
        lang = languageCode + "_" + countryCode.toUpperCase();
    }
    return lang;
}

function getCountryName() {
    var lang = "";
    var metaElements = document.all ?
            document.all.tags('meta') :
            document.getElementsByTagName ?
            document.getElementsByTagName ('meta') : new Array();
    for (var m = 0; m < metaElements.length; m++) {
        if (metaElements[m].name == "lang") {
            lang = metaElements[m].content;
            break;
        }
    }
    var ptn = /(..)-(..)/;
    if ((ptn.test(lang)) && (lang != "en-us")) {
        var countryCode = lang.replace(ptn, "$2");
        return "/" + countryCode;
    }
    return "";
}

if ( (typeof(terms_HELPCFG) != 'undefined')  && (terms_HELPCFG.indexOf(".helpcfg") != -1) ) {
    var stage   = (document.location.href.indexOf(".stage.") != -1) ? 'stage.' : '';
    var baseUrl = 'http://www.' + stage + 'adobe.com';
    var refpage = document.location.href.replace(/#.*$/, '');
	
	if ((!use_robohelp_behavior) && (terms_HELPCFG.length > 0) && (typeof(cfgArray[terms_HELPCFG]) != 'undefined') && (cfgArray[terms_HELPCFG].length > 0)) {
		if (document.getElementById) { // DOM3 = IE5, NS6
			var newHref = baseUrl + getCountryName() + "/support/chc/" + "?helpcfg=http://help." + stage + "adobe.com/HelpCfg/" + getLangName() + "/" + terms_HELPCFG + "&url=" + refpage + "&product=" + cfgArray[terms_HELPCFG];
			var newSrc = baseUrl + getCountryName() + "/support/chc/GetMoreHelpFeatures.png";
			document.getElementById("chcPromo").style.display = "block";
			document.getElementById("chcLink").href = newHref;
			document.getElementById("chcImage").src = newSrc;
		}
	}
}

//-->
</script>


          <div id="minitoc">
           <div class="t">
            <div class="b">
             <div>
              <ul id="minitoc-links">
               <li>
                <p>
                 <a href="#WS8FAE5151-90D9-45e0-8ABD-09C17C4E6D36">
                  <span class="topictitle1">
                   Uses for an encrypted database
                  </span>
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a href="#WS00469B81-CE46-48d3-A825-A179339FA9B4">
                  <span class="topictitle1">
                   Creating an encrypted database
                  </span>
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a href="#WS6A88523A-68C0-469e-8271-620A29661799">
                  <span class="topictitle1">
                   Connecting to an encrypted database
                  </span>
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a href="#WS09F24BEF-BEE3-4d36-9190-7CA9B0F24DA1">
                  <span class="topictitle1">
                   Changing the encryption key of a database
                  </span>
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a href="#WS34990ABF-C893-47ec-B813-9C9D9587A398">
                  <span class="topictitle1">
                   Considerations for using encryption with a database
                  </span>
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a href="#WS61068DCE-9499-4d40-82B8-B71CC35D832C">
                  <span class="topictitle1">
                   Example: Generating and using an encryption key
                  </span>
                 </a>
                </p>
                <ul>
                 <li>
                  <p>
                   <a href="#WS44EC31A7-61B1-4e0a-8C61-D720AA95DE03">
                    <span class="topictitle2">
                     Using the EncryptionKeyGenerator class to obtain a secure encryption key
                    </span>
                   </a>
                  </p>
                 </li>
                 <li>
                  <p>
                   <a href="#WSAD329515-CBF1-4658-8DD7-CAC9C354CE94">
                    <span class="topictitle2">
                     Complete example code for generating and using an encryption key
                    </span>
                   </a>
                  </p>
                 </li>
                 <li>
                  <p>
                   <a href="#WS495D91DF-659A-4a6f-8944-EA08072C2D4C">
                    <span class="topictitle2">
                     Understanding the EncryptionKeyGenerator class
                    </span>
                   </a>
                  </p>
                  <ul>
                   <li>
                    <p>
                     <a href="#WSE01C3A40-C022-4820-95FA-34D3B15654AE">
                      <span class="topictitle3">
                       Obtain and validate a strong password
                      </span>
                     </a>
                    </p>
                   </li>
                   <li>
                    <p>
                     <a href="#WS2DC7AA20-EA16-42d0-96A4-917B0F2BE1B0">
                      <span class="topictitle3">
                       Expand the password to 256 bits
                      </span>
                     </a>
                    </p>
                   </li>
                   <li>
                    <p>
                     <a href="#WSEDEE3767-B59B-4f9b-8D70-F36EFC0F07D3">
                      <span class="topictitle3">
                       Generate or retrieve a 256-bit salt value
                      </span>
                     </a>
                    </p>
                   </li>
                   <li>
                    <p>
                     <a href="#WS352D1548-645D-4ec1-8CE5-BFB375571C29">
                      <span class="topictitle3">
                       Combine the 256-bit password and salt using the XOR operator
                      </span>
                     </a>
                    </p>
                   </li>
                   <li>
                    <p>
                     <a href="#WSEC3CAF33-DE87-4119-ABA7-0E618AFC1D05">
                      <span class="topictitle3">
                       Hash the key
                      </span>
                     </a>
                    </p>
                   </li>
                   <li>
                    <p>
                     <a href="#WS201AE506-5799-426e-ADE9-5EBFE0458D59">
                      <span class="topictitle3">
                       Extract the encryption key from the hash
                      </span>
                     </a>
                    </p>
                   </li>
                  </ul>
                 </li>
                </ul>
               </li>
              </ul>
             </div>
            </div>
           </div>
          </div>
          <div>
           <p>
            All Adobe AIR applications share the same local database engine.
Consequently, any AIR application can connect to, read from, and
write to an unencrypted database file. Starting with Adobe AIR 1.5,
AIR includes the capability of creating and connecting to encrypted
database files. When you use an encrypted database, in order to
connect to the database an application must provide the correct
encryption key. If the incorrect encryption key (or no key) is provided,
the application is not able to connect to the database. Consequently,
the application can’t read data from the database or write to or
change data in the database.
           </p>
           <p>
            To use an encrypted database, you must create the database as
an encrypted database. With an existing encrypted database, you
can open a connection to the database. You can also change the encryption
key of an encrypted database. Other than creating and connecting
to encrypted databases, the techniques for working with an encrypted
database are the same as for working with an unencrypted one. In
particular, executing SQL statements is the same regardless of whether
a database is encrypted or not.
           </p>
          </div>
          <div class="nochunk" id="WS8FAE5151-90D9-45e0-8ABD-09C17C4E6D36">
           <a name="WS8FAE5151-90D9-45e0-8ABD-09C17C4E6D36">
            <!-- -->
           </a>
           <h2 class="topictitle2">
            Uses for an encrypted database
           </h2>
           <div>
            <p>
             Encryption is useful any time you want to restrict access to
the information stored in a database. The database encryption functionality
of Adobe AIR can be used for several purposes. The following are
some examples of cases where you would want to use an encrypted
database:
            </p>
            <ul>
             <li>
              <p>
               A read-only cache of private application data downloaded
from a server
              </p>
             </li>
             <li>
              <p>
               A local application store for private data that is synchronized
with a server (data is sent to and loaded from the server)
              </p>
             </li>
             <li>
              <p>
               Encrypted files used as the file format for documents created
and edited by the application. The files could be private to one
user, or could be designed to be shared among all users of the application.
              </p>
             </li>
             <li>
              <p>
               Any other use of a local data store, such as the ones described
in
               <a href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d31.html">
                Uses for local SQL databases
               </a>
               , where the data must be kept private
from people who have access to the machine or the database files.
              </p>
             </li>
            </ul>
            <p>
             Understanding the reason why you want to use an encrypted database
helps you decide how to architect your application. In particular,
it can affect how your application creates, obtains, and stores
the encryption key for the database. For more information about
these considerations, see
             <a href="WS34990ABF-C893-47ec-B813-9C9D9587A398.html">
              Considerations for using encryption with a database
             </a>
             .
            </p>
            <p>
             Other than an encrypted database, an alternative mechanism for
keeping sensitive data private is the
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/data/EncryptedLocalStore.html">
              encrypted local store
             </a>
             . With the encrypted local store, you
store a single
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/utils/ByteArray.html">
              ByteArray
             </a>
             value using a String
key. Only the AIR application that stores the value can access it,
and only on the computer on which it is stored. With the encrypted
local store, it isn’t necessary to create your own encryption key.
For these reasons, the encrypted local store is most suitable for
easily storing a single value or set of values that can easily be
encoded in a ByteArray. An encrypted database is most suitable for
larger data sets where structured data storage and querying are
desirable. For more information about using the encrypted local
store, see
             <a href="WS5b3ccc516d4fbf351e63e3d118666ade46-7e31.html">
              Encrypted local storage
             </a>
             .
            </p>
           </div>
          </div>
          <div class="nochunk" id="WS00469B81-CE46-48d3-A825-A179339FA9B4">
           <a name="WS00469B81-CE46-48d3-A825-A179339FA9B4">
            <!-- -->
           </a>
           <h2 class="topictitle2">
            Creating an encrypted database
           </h2>
           <div>
            <p>
             To use an encrypted database, the database file must be encrypted
when it is created. Once a database is created as unencrypted, it
can’t be encrypted later. Likewise, an encrypted database can’t
be unencrypted later. If needed you can change the encryption key
of an encrypted database. For details, see
             <a href="WS09F24BEF-BEE3-4d36-9190-7CA9B0F24DA1.html">
              Changing the encryption key of a database
             </a>
             . If you have an existing database
that’s not encrypted and you want to use database encryption, you
can create a new encrypted database and copy the existing table
structure and data to the new database.
            </p>
            <p>
             Creating an encrypted database is nearly identical to creating
an unencrypted database, as described in
             <a href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d44.html">
              Creating a database
             </a>
             . You first create a
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/data/SQLConnection.html">
              SQLConnection
             </a>
             instance
that represents the connection to the database. You create the database by
calling the SQLConnection object’s
             <samp class="codeph">
              open()
             </samp>
             method
or
             <samp class="codeph">
              openAsync()
             </samp>
             method, specifying for the database
location a file that doesn’t exist yet. The only difference when
creating an encrypted database is that you provide a value for the
             <samp class="codeph">
              encryptionKey
             </samp>
             parameter
(the
             <samp class="codeph">
              open()
             </samp>
             method’s fifth parameter and the
             <samp class="codeph">
              openAsync()
             </samp>
             method’s
sixth parameter).
            </p>
            <p>
             A valid
             <samp class="codeph">
              encryptionKey
             </samp>
             parameter value is a
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/utils/ByteArray.html">
              ByteArray
             </a>
             object
containing exactly 16 bytes.
            </p>
            <p>
             The following examples demonstrate creating an encrypted database.
For simplicity, in these examples the encryption key is hard-coded
in the application code. However, this technique is strongly discouraged
because it is not secure.
            </p>
            <pre>var conn:SQLConnection = new SQLConnection(); 
     
var encryptionKey:ByteArray = new ByteArray(); 
encryptionKey.writeUTFBytes("Some16ByteString"); // This technique is not secure! 
     
// Create an encrypted database in asynchronous mode 
conn.openAsync(dbFile, SQLMode.CREATE, null, false, 1024, encryptionKey); 
     
// Create an encrypted database in synchronous mode 
conn.open(dbFile, SQLMode.CREATE, false, 1024, encryptionKey);</pre>
            <p>
             For an example demonstrating a recommended way to generate an
encryption key, see
             <a href="WS61068DCE-9499-4d40-82B8-B71CC35D832C.html">
              Example: Generating and using an encryption key
             </a>
             .
            </p>
           </div>
          </div>
          <div class="nochunk" id="WS6A88523A-68C0-469e-8271-620A29661799">
           <a name="WS6A88523A-68C0-469e-8271-620A29661799">
            <!-- -->
           </a>
           <h2 class="topictitle2">
            Connecting to an encrypted database
           </h2>
           <div>
            <p>
             Like creating an encrypted database, the procedure for opening
a connection to an encrypted database is like connecting to an unencrypted
database. That procedure is described in greater detail in
             <a href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d32.html">
              Connecting to a database
             </a>
             . You use the
             <samp class="codeph">
              open()
             </samp>
             method
to
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/data/SQLConnection.html#open()#open()">
              open a connection in synchronous execution mode
             </a>
             ,
or the
             <samp class="codeph">
              openAsync()
             </samp>
             method to
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/data/SQLConnection.html#openAsync()#openAsync()">
              open a connection in asynchronous execution mode
             </a>
             . The
only difference is that to open an encrypted database, you specify
the correct value for the
             <samp class="codeph">
              encryptionKey
             </samp>
             parameter
(the
             <samp class="codeph">
              open()
             </samp>
             method’s fifth parameter and the
             <samp class="codeph">
              openAsync()
             </samp>
             method’s
sixth parameter).
            </p>
            <p>
             If the encryption key that’s provided is not correct, an error
occurs. For the
             <samp class="codeph">
              open()
             </samp>
             method, a
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/errors/SQLError.html">
              SQLError
             </a>
             exception
is thrown. For the
             <samp class="codeph">
              openAsync()
             </samp>
             method, the
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/data/SQLConnection.html">
              SQLConnection
             </a>
             object
dispatches a
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/events/SQLErrorEvent.html">
              SQLErrorEvent
             </a>
             , whose
             <samp class="codeph">
              error
             </samp>
             property
contains a
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/errors/SQLError.html">
              SQLError
             </a>
             object. In either
case, the SQLError object generated by the exception has the
             <samp class="codeph">
              errorID
             </samp>
             property
value 3138. That error ID corresponds to the error message “File
opened is not a database file.”
            </p>
            <p>
             The following example demonstrates opening an encrypted database
in asynchronous execution mode. For simplicity, in this example
the encryption key is hard-coded in the application code. However,
this technique is strongly discouraged because it is not secure.
            </p>
            <pre>import flash.data.SQLConnection; 
import flash.data.SQLMode; 
import flash.events.SQLErrorEvent; 
import flash.events.SQLEvent; 
import flash.filesystem.File; 
     
var conn:SQLConnection = new SQLConnection(); 
conn.addEventListener(SQLEvent.OPEN, openHandler); 
conn.addEventListener(SQLErrorEvent.ERROR, errorHandler); 
var dbFile:File = File.applicationStorageDirectory.resolvePath("DBSample.db"); 
     
var encryptionKey:ByteArray = new ByteArray(); 
encryptionKey.writeUTFBytes("Some16ByteString"); // This technique is not secure! 
     
conn.openAsync(dbFile, SQLMode.UPDATE, null, false, 1024, encryptionKey); 
     
function openHandler(event:SQLEvent):void 
{ 
    trace("the database opened successfully"); 
} 
     
function errorHandler(event:SQLErrorEvent):void 
{ 
    if (event.error.errorID == 3138) 
    { 
        trace("Incorrect encryption key"); 
    } 
    else 
    { 
        trace("Error message:", event.error.message); 
        trace("Details:", event.error.details); 
    } 
} </pre>
            <p>
             The following example demonstrates opening an encrypted database
in synchronous execution mode. For simplicity, in this example the
encryption key is hard-coded in the application code. However, this
technique is strongly discouraged because it is not secure.
            </p>
            <pre>import flash.data.SQLConnection; 
import flash.data.SQLMode; 
import flash.filesystem.File; 
     
var conn:SQLConnection = new SQLConnection(); 
var dbFile:File = File.applicationStorageDirectory.resolvePath("DBSample.db"); 
     
var encryptionKey:ByteArray = new ByteArray(); 
encryptionKey.writeUTFBytes("Some16ByteString"); // This technique is not secure! 
     
try 
{ 
    conn.open(dbFile, SQLMode.UPDATE, false, 1024, encryptionKey); 
    trace("the database was created successfully"); 
} 
catch (error:SQLError) 
{ 
    if (error.errorID == 3138) 
    { 
        trace("Incorrect encryption key"); 
    } 
    else 
    { 
        trace("Error message:", error.message); 
        trace("Details:", error.details); 
    } 
} </pre>
            <p>
             For an example demonstrating a recommended way to generate an
encryption key, see
             <a href="WS61068DCE-9499-4d40-82B8-B71CC35D832C.html">
              Example: Generating and using an encryption key
             </a>
             .
            </p>
           </div>
          </div>
          <div class="nochunk" id="WS09F24BEF-BEE3-4d36-9190-7CA9B0F24DA1">
           <a name="WS09F24BEF-BEE3-4d36-9190-7CA9B0F24DA1">
            <!-- -->
           </a>
           <h2 class="topictitle2">
            Changing the encryption key of a database
           </h2>
           <div>
            <p>
             When a database is encrypted, you can change the encryption key
for the database at a later time. To change a database’s encryption
key, first open a connection to the database by creating a
             <a href="http://help.adobe.com/en_US/Flash/CS5/AS3LR/flash/data/SQLConnection.html">
              SQLConnection
             </a>
             instance
and calling its
             <samp class="codeph">
              open()
             </samp>
             or
             <samp class="codeph">
              openAsync()
             </samp>
             method.
Once the database is connected, call the
             <samp class="codeph">
              reencrypt()
             </samp>
             method,
passing the new encryption key as an argument.
            </p>
            <p>
             Like most database operations, the
             <samp class="codeph">
              reencrypt()
             </samp>
             method’s
behavior varies depending on whether the database connection uses
synchronous or asynchronous execution mode. If you use the
             <samp class="codeph">
              open()
             </samp>
             method
to connect to the database, the
             <samp class="codeph">
              reencrypt()
             </samp>
             operation
runs synchronously. When the operation finishes, execution continues
with the next line of code:
            </p>
            <pre>var newKey:ByteArray = new ByteArray(); 
// ... generate the new key and store it in newKey 
conn.reencrypt(newKey);</pre>
            <p>
             On the other hand, if the database connection is opened using
the
             <samp class="codeph">
              openAsync()
             </samp>
             method, the
             <samp class="codeph">
              reencrypt()
             </samp>
             operation
is asynchronous. Calling
             <samp class="codeph">
              reencrypt()
             </samp>
             begins the
reencryption process. When the operation completes, the SQLConnection
object dispatches a
             <samp class="codeph">
              reencrypt
             </samp>
             event. You use an
event listener to determine when the reencryption finishes:
            </p>
            <pre>var newKey:ByteArray = new ByteArray(); 
// ... generate the new key and store it in newKey 
     
conn.addEventListener(SQLEvent.REENCRYPT, reencryptHandler); 
     
conn.reencrypt(newKey); 
     
function reencryptHandler(event:SQLEvent):void 
{ 
    // save the fact that the key changed 
}</pre>
            <p>
             The
             <samp class="codeph">
              reencrypt()
             </samp>
             operation runs in its own transaction.
If the operation is interrupted or fails (for example, if the application
is closed before the operation finishes) the transaction is rolled
back. In that case, the original encryption key is still the encryption
key for the database.
            </p>
            <p>
             The
             <samp class="codeph">
              reencrypt()
             </samp>
             method can’t be used to remove
encryption from a database. Passing a
             <samp class="codeph">
              null
             </samp>
             value
or encryption key that’s not a 16-byte ByteArray to the
             <samp class="codeph">
              reencrypt()
             </samp>
             method
results in an error.
            </p>
           </div>
          </div>
          <div class="nochunk" id="WS34990ABF-C893-47ec-B813-9C9D9587A398">
           <a name="WS34990ABF-C893-47ec-B813-9C9D9587A398">
            <!-- -->
           </a>
           <h2 class="topictitle2">
            Considerations for using encryption with a database
           </h2>
           <div>
            <p>
             The section
             <a href="WS8FAE5151-90D9-45e0-8ABD-09C17C4E6D36.html">
              Uses for an encrypted database
             </a>
             presents several cases in which
you would want to use an encrypted database. It’s obvious that the
usage scenarios of different applications (including these and other
scenarios) have different privacy requirements. The way you architect
the use of encryption in your application plays an important part
in controlling how private a database’s data is. For example, if
you are using an encrypted database to keep personal data private, even
from other users of the same machine, then each user’s database
needs its own encryption key. For the greatest security, your application
can generate the key from a user-entered password. Basing the encryption
key on a password ensures that even if another person is able to
impersonate the user’s account on the machine, the data still can’t
be accessed. On the other end of the privacy spectrum, suppose you
want a database file to be readable by any user of your application
but not to other applications. In that case every installed copy
of the application needs access to a shared encryption key.
            </p>
            <p>
             You can design your application, and in particular the technique
used to generate the encryption key, according to the level of privacy
that you want for your application data. The following list provides
design suggestions for various levels of data privacy:
            </p>
            <ul>
             <li>
              <p>
               To make a database accessible to any user who has access
to the application on any machine, use a single key that’s available
to all instances of the application. For example, the first time
an application runs it can download the shared encryption key from
a server using a secure protocol such as SSL. It can then save the
key in the encrypted local store for future use. As an alternative, encrypt
the data per-user on the machine, and synchronize the data with
a remote data store such as a server to make the data portable.
              </p>
             </li>
             <li>
              <p>
               To make a database accessible to a single user on any machine,
generate the encryption key from a user secret (such as a password).
In particular, do not use any value that’s tied to a particular
computer (such as a value stored in the encrypted local store) to
generate the key. As an alternative, encrypt the data per-user on
the machine, and synchronize the data with a remote data store such
as a server to make the data portable.
              </p>
             </li>
             <li>
              <p>
               To make a database accessible only to a single individual
on a single machine, generate the key from a password and a generated
salt. For an example of this technique, see
               <a href="WS61068DCE-9499-4d40-82B8-B71CC35D832C.html">
                Example: Generating and using an encryption key
               </a>
               .
              </p>
             </li>
            </ul>
            <p>
             The following are additional security considerations that are
important to keep in mind when designing an application to use an
encrypted database:
            </p>
            <ul>
             <li>
              <p>
               A system is only as secure as its weakest link. If you
are using a user-entered password to generate an encryption key,
consider imposing minimum length and complexity restrictions on
passwords. A short password that uses only basic characters can
be guessed quickly.
              </p>
             </li>
             <li>
              <p>
               The source code of an AIR application is stored on a user’s
machine in plain text (for HTML content) or an easily decompilable
binary format (for SWF content). Because the source code is accessible,
two points to remember are:
              </p>
              <ul>
               <li>
                <p>
                 Never hard-code an encryption
key in your source code
                </p>
               </li>
               <li>
                <p>
                 Always assume that the technique used to generate an encryption
key (such as random character generator or a particular hashing
algorithm) can be easily worked out by an attacker
                </p>
               </li>
              </ul>
             </li>
             <li>
              <p>
               AIR database encryption uses the Advanced Encryption Standard
(AES) with Counter with CBC-MAC (CCM) mode. This encryption cipher
requires a user-entered key to be combined with a salt value to
be secure. For an example of this, see
               <a href="WS61068DCE-9499-4d40-82B8-B71CC35D832C.html">
                Example: Generating and using an encryption key
               </a>
               .
              </p>
             </li>
             <li>
              <p>
               When you elect to encrypt a database, all disk files used
by the database engine in conjunction with that database are encrypted.
However, the database engine holds some data temporarily in an in-memory
cache to improve read- and write-time performance in transactions.
Any memory-resident data is unencrypted. If an attacker is able
to access the memory used by an AIR application, for example by
using a debugger, the data in a database that is currently open
and unencrypted would be available.
              </p>
             </li>
            </ul>
           </div>
          </div>
          <div class="nochunk" id="WS61068DCE-9499-4d40-82B8-B71CC35D832C">
           <a name="WS61068DCE-9499-4d40-82B8-B71CC35D832C">
            <!-- -->
           </a>
           <h2 class="topictitle2">
            Example: Generating and using an encryption key
           </h2>
           <div>
            <p>
             This example application demonstrates one technique for generating
an encryption key. This application is designed to provide the highest
level of privacy and security for users’ data. One important aspect
of securing private data is to require the user to enter a password
each time the application connects to the database. Consequently,
as shown in this example, an application that requires this level
of privacy should never directly store the database encryption key.
            </p>
            <p>
             The application consists of two parts: an ActionScript class
that generates an encryption key (the EncryptionKeyGenerator class),
and a basic user interface that demonstrates how to use that class.
For the complete source code, see
             <a href="WSAD329515-CBF1-4658-8DD7-CAC9C354CE94.html">
              Complete example code for generating and using an encryption key
             </a>
             .
            </p>
           </div>
           <div class="nochunk" id="WS44EC31A7-61B1-4e0a-8C61-D720AA95DE03">
            <a name="WS44EC31A7-61B1-4e0a-8C61-D720AA95DE03">
             <!-- -->
            </a>
            <h3 class="topictitle3">
             Using the EncryptionKeyGenerator class to obtain a secure encryption key
            </h3>
            <div>
             <p>
              It isn’t necessary to understand the details of how the EncryptionKeyGenerator class
works to use it in your application. If you are interested in the
details of how the class generates an encryption key for a database,
see
              <a href="WS495D91DF-659A-4a6f-8944-EA08072C2D4C.html">
               Understanding the EncryptionKeyGenerator class
              </a>
              .
             </p>
             <p>
              Follow these steps to use the EncryptionKeyGenerator class in
your application:
             </p>
             <ol>
              <li>
               <p>
                Download
the EncryptionKeyGenerator class as source code or a compiled SWC.
The EncryptionKeyGenerator class is included in the open-source ActionScript
3.0 core library (as3corelib) project. You can download
                <a href="http://www.adobe.com/go/learn_air_opensource_encryptionkey" target="_self">
                 the as3corelib package including source code
and documentation
                </a>
                . You can also download the SWC or source
code files from the project page.
               </p>
              </li>
              <li>
               <p>
                Place
the source code for the EncryptionKeyGenerator class (or the as3corelib SWC)
in a location where your application source code can find it.
               </p>
              </li>
              <li>
               <p>
                In
your application source code, add an
                <samp class="codeph">
                 import
                </samp>
                statement
for the EncryptionKeyGenerator class.
               </p>
               <pre>import com.adobe.air.crypto.EncryptionKeyGenerator;</pre>
              </li>
              <li>
               <p>
                Before the point where the code creates the database or opens
a connection to it, add code to create an EncryptionKeyGenerator
instance by calling the
                <samp class="codeph">
                 EncryptionKeyGenerator()
                </samp>
                constructor.
               </p>
               <pre>var keyGenerator:EncryptionKeyGenerator = new EncryptionKeyGenerator();</pre>
              </li>
              <li>
               <p>
                Obtain a password from the user:
               </p>
               <pre>var password:String = passwordInput.text; 
 
if (!keyGenerator.validateStrongPassword(password)) 
{ 
    // display an error message 
    return; 
}</pre>
               <p>
                The EncryptionKeyGenerator instance uses this password
as the basis for the encryption key (shown in the next step). The
EncryptionKeyGenerator instance tests the password against certain
strong password validation requirements. If the validation fails,
an error occurs. As the example code shows, you can check the password
ahead of time by calling the EncryptionKeyGenerator object’s
                <samp class="codeph">
                 validateStrongPassword()
                </samp>
                method.
That way you can determine whether the password meets the minimum
requirements for a strong password and avoid an error.
               </p>
              </li>
              <li>
               <p>
                Generate the encryption key from the password:
               </p>
               <pre>var encryptionKey:ByteArray = keyGenerator.getEncryptionKey(password);</pre>
               <p>
                The
                <samp class="codeph">
                 getEncryptionKey()
                </samp>
                method
generates and returns the encryption key (a 16-byte ByteArray).
You can then use the encryption key to create your new encrypted
database or open your existing one.
               </p>
               <p>
                The
                <samp class="codeph">
                 getEncryptionKey()
                </samp>
                method
has one required parameter, which is the password obtained in step
5.
               </p>
               <div class="note">
                <span class="notetitle">
                 Note:
                </span>
                To maintain the highest level of security and privacy
for data, an application must require the user to enter a password
each time the application connects to the database. Do not store
the user’s password or the database encryption key directly. Doing
so exposes security risks. Instead, as demonstrated in this example, an
application should use the same technique to derive the encryption
key from the password both when creating the encrypted database
and when connecting to it later.
               </div>
               <p>
                The
                <samp class="codeph">
                 getEncryptionKey()
                </samp>
                method
also accepts a second (optional) parameter, the
                <samp class="codeph">
                 overrideSaltELSKey
                </samp>
                parameter.
The EncryptionKeyGenerator creates a random value (known as a
                <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">
                 salt
                </i>
                )
that is used as part of the encryption key. In order to be able
to re-create the encryption key, the salt value is stored in the
Encrypted Local Store (ELS) of your AIR application. By default,
the EncryptionKeyGenerator class uses a particular String as the
ELS key. Although unlikely, it’s possible that the key can conflict
with another key your application uses. Instead of using the default
key, you might want to specify your own ELS key. In that case, specify
a custom key by passing it as the second
                <samp class="codeph">
                 getEncryptionKey()
                </samp>
                parameter,
as shown here:
               </p>
               <pre>var customKey:String = "My custom ELS salt key"; 
var encryptionKey:ByteArray = keyGenerator.getEncryptionKey(password, customKey);</pre>
              </li>
              <li>
               <p>
                Create or open the database
               </p>
               <p>
                With an encryption key
returned by the
                <samp class="codeph">
                 getEncryptionKey()
                </samp>
                method, your
code can create a new encrypted database or attempt to open the existing
encrypted database. In either case you use the SQLConnection class’s
                <samp class="codeph">
                 open()
                </samp>
                or
                <samp class="codeph">
                 openAsync()
                </samp>
                method,
as described in
                <a href="WS00469B81-CE46-48d3-A825-A179339FA9B4.html">
                 Creating an encrypted database
                </a>
                and
                <a href="WS6A88523A-68C0-469e-8271-620A29661799.html">
                 Connecting to an encrypted database
                </a>
                .
               </p>
               <p>
                In this example, the application
is designed to open the database in asynchronous execution mode.
The code sets up the appropriate event listeners and calls the
                <samp class="codeph">
                 openAsync()
                </samp>
                method,
passing the encryption key as the final argument:
               </p>
               <pre>conn.addEventListener(SQLEvent.OPEN, openHandler); 
conn.addEventListener(SQLErrorEvent.ERROR, openError); 
 
conn.openAsync(dbFile, SQLMode.CREATE, null, false, 1024, encryptionKey);</pre>
               <p>
                In
the listener methods, the code removes the event listener registrations.
It then displays a status message indicating whether the database
was created, opened, or whether an error occurred. The most noteworthy
part of these event handlers is in the
                <samp class="codeph">
                 openError()
                </samp>
                method.
In that method an
                <samp class="codeph">
                 if
                </samp>
                statement checks if the database
exists (meaning that the code is attempting to connect to an existing
database) and if the error ID matches the constant
                <samp class="codeph">
                 EncryptionKeyGenerator.ENCRYPTED_DB_PASSWORD_ERROR_ID
                </samp>
                . If
both of these conditions are true, it probably means that the password
the user entered is incorrect. (It could also mean that the specified
file isn’t a database file at all.) The following is the code that
checks the error ID:
               </p>
               <pre>if (!createNewDB &amp;&amp; event.error.errorID == EncryptionKeyGenerator.ENCRYPTED_DB_PASSWORD_ERROR_ID) 
{ 
    statusMsg.text = "Incorrect password!"; 
} 
else 
{ 
    statusMsg.text = "Error creating or opening database."; 
}</pre>
               <p>
                For the complete code for the example event listeners,
see
                <a href="WSAD329515-CBF1-4658-8DD7-CAC9C354CE94.html">
                 Complete example code for generating and using an encryption key
                </a>
                .
               </p>
              </li>
             </ol>
            </div>
           </div>
           <div class="nochunk" id="WSAD329515-CBF1-4658-8DD7-CAC9C354CE94">
            <a name="WSAD329515-CBF1-4658-8DD7-CAC9C354CE94">
             <!-- -->
            </a>
            <h3 class="topictitle3">
             Complete example code for generating and using an encryption key
            </h3>
            <div>
             <p>
              The following is the complete code for the example application
“Generating and using an encryption key.” The code consists of two
parts.
             </p>
             <p>
              The example uses the EncryptionKeyGenerator class to create an
encryption key from a password. The EncryptionKeyGenerator class
is included in the open-source ActionScript 3.0 core library (as3corelib)
project. You can download
              <a href="http://www.adobe.com/go/learn_air_opensource_encryptionkey" target="_self">
               the as3corelib package including source code
and documentation
              </a>
              . You can also download the SWC or source
code files from the project page.
             </p>
             <div class="section">
              <h4 class="sectiontitle">
               Flex example
              </h4>
              <p>
               The
application MXML file contains the source code for a simple application
that creates or opens a connection to an encrypted database:
              </p>
              <pre>&lt;?xml version="1.0" encoding="utf-8"?&gt; 
&lt;mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" creationComplete="init();"&gt; 
    &lt;mx:Script&gt; 
        &lt;![CDATA[ 
            import com.adobe.air.crypto.EncryptionKeyGenerator; 
             
            private const dbFileName:String = "encryptedDatabase.db"; 
             
            private var dbFile:File; 
            private var createNewDB:Boolean = true; 
            private var conn:SQLConnection; 
             
            // ------- Event handling ------- 
             
            private function init():void 
            { 
                conn = new SQLConnection(); 
                dbFile = File.applicationStorageDirectory.resolvePath(dbFileName); 
                if (dbFile.exists) 
                { 
                    createNewDB = false; 
                    instructions.text = "Enter your database password to open the encrypted database."; 
                    openButton.label = "Open Database"; 
                } 
            } 
             
            private function openConnection():void 
            { 
                var password:String = passwordInput.text; 
                 
                var keyGenerator:EncryptionKeyGenerator = new EncryptionKeyGenerator(); 
                 
                if (password == null || password.length &lt;= 0) 
                { 
                    statusMsg.text = "Please specify a password."; 
                    return; 
                } 
                 
                if (!keyGenerator.validateStrongPassword(password)) 
                { 
                    statusMsg.text = "The password must be 8-32 characters long. It must contain at least one lowercase letter, at least one uppercase letter, and at least one number or symbol."; 
                    return; 
                } 
                 
                passwordInput.text = ""; 
                passwordInput.enabled = false; 
                openButton.enabled = false; 
                 
                var encryptionKey:ByteArray = keyGenerator.getEncryptionKey(password); 
                 
                conn.addEventListener(SQLEvent.OPEN, openHandler); 
                conn.addEventListener(SQLErrorEvent.ERROR, openError); 
                  
                conn.openAsync(dbFile, SQLMode.CREATE, null, false, 1024, encryptionKey); 
            } 
             
            private function openHandler(event:SQLEvent):void 
            { 
                conn.removeEventListener(SQLEvent.OPEN, openHandler); 
                conn.removeEventListener(SQLErrorEvent.ERROR, openError); 
                  
                statusMsg.setStyle("color", 0x009900); 
                if (createNewDB) 
                { 
                    statusMsg.text = "The encrypted database was created successfully."; 
                } 
                else 
                { 
                    statusMsg.text = "The encrypted database was opened successfully."; 
                } 
            } 
              
            private function openError(event:SQLErrorEvent):void 
            { 
                conn.removeEventListener(SQLEvent.OPEN, openHandler); 
                conn.removeEventListener(SQLErrorEvent.ERROR, openError); 
     
                if (!createNewDB &amp;&amp; event.error.errorID == EncryptionKeyGenerator.ENCRYPTED_DB_PASSWORD_ERROR_ID) 
                { 
                    statusMsg.text = "Incorrect password!"; 
                } 
                else 
                { 
                    statusMsg.text = "Error creating or opening database."; 
                } 
            } 
        ]]&gt; 
    &lt;/mx:Script&gt; 
    &lt;mx:Text id="instructions" text="Enter a password to create an encrypted database. The next time you open the application, you will need to re-enter the password to open the database again." width="75%" height="65"/&gt; 
    &lt;mx:HBox&gt; 
        &lt;mx:TextInput id="passwordInput" displayAsPassword="true"/&gt; 
        &lt;mx:Button id="openButton" label="Create Database" click="openConnection();"/&gt; 
    &lt;/mx:HBox&gt; 
    &lt;mx:Text id="statusMsg" color="#990000" width="75%"/&gt; 
&lt;/mx:WindowedApplication&gt;</pre>
             </div>
             <div class="section">
              <h4 class="sectiontitle">
               Flash Professional example
              </h4>
              <p>
               The application FLA file contains
the source code for a simple application that creates or opens a
connection to an encrypted database. The FLA file has four components
placed on the stage:
              </p>
              <div class="tablenoborder">
               <table border="1" cellpadding="4" cellspacing="0">
                <thead align="left">
                 <tr>
                  <th id="d17e50936" valign="top" width="NaN%">
                   <p>
                    Instance name
                   </p>
                  </th>
                  <th id="d17e50939" valign="top" width="NaN%">
                   <p>
                    Component type
                   </p>
                  </th>
                  <th id="d17e50942" valign="top" width="NaN%">
                   <p>
                    Description
                   </p>
                  </th>
                 </tr>
                </thead>
                <tbody>
                 <tr>
                  <td headers="d17e50936 " valign="top" width="NaN%">
                   <p>
                    <samp class="codeph">
                     instructions
                    </samp>
                   </p>
                  </td>
                  <td headers="d17e50939 " valign="top" width="NaN%">
                   <p>
                    Label
                   </p>
                  </td>
                  <td headers="d17e50942 " valign="top" width="NaN%">
                   <p>
                    Contains the instructions given to the user
                   </p>
                  </td>
                 </tr>
                 <tr>
                  <td headers="d17e50936 " valign="top" width="NaN%">
                   <p>
                    <samp class="codeph">
                     passwordInput
                    </samp>
                   </p>
                  </td>
                  <td headers="d17e50939 " valign="top" width="NaN%">
                   <p>
                    TextInput
                   </p>
                  </td>
                  <td headers="d17e50942 " valign="top" width="NaN%">
                   <p>
                    Input field where the user enters the password
                   </p>
                  </td>
                 </tr>
                 <tr>
                  <td headers="d17e50936 " valign="top" width="NaN%">
                   <p>
                    <samp class="codeph">
                     openButton
                    </samp>
                   </p>
                  </td>
                  <td headers="d17e50939 " valign="top" width="NaN%">
                   <p>
                    Button
                   </p>
                  </td>
                  <td headers="d17e50942 " valign="top" width="NaN%">
                   <p>
                    Button the user clicks after entering the
password
                   </p>
                  </td>
                 </tr>
                 <tr>
                  <td headers="d17e50936 " valign="top" width="NaN%">
                   <p>
                    <samp class="codeph">
                     statusMsg
                    </samp>
                   </p>
                  </td>
                  <td headers="d17e50939 " valign="top" width="NaN%">
                   <p>
                    Label
                   </p>
                  </td>
                  <td headers="d17e50942 " valign="top" width="NaN%">
                   <p>
                    Displays status (success or failure) messages
                   </p>
                  </td>
                 </tr>
                </tbody>
               </table>
              </div>
              <p>
               The
code for the application is defined on a keyframe on frame 1 of
the main timeline. The following is the code for the application:
              </p>
              <pre>import com.adobe.air.crypto.EncryptionKeyGenerator; 
     
const dbFileName:String = "encryptedDatabase.db"; 
     
var dbFile:File; 
var createNewDB:Boolean = true; 
var conn:SQLConnection; 
     
init(); 
     
// ------- Event handling ------- 
     
function init():void 
{ 
    passwordInput.displayAsPassword = true; 
    openButton.addEventListener(MouseEvent.CLICK, openConnection); 
    statusMsg.setStyle("textFormat", new TextFormat(null, null, 0x990000)); 
     
    conn = new SQLConnection(); 
    dbFile = File.applicationStorageDirectory.resolvePath(dbFileName); 
     
    if (dbFile.exists) 
    { 
        createNewDB = false; 
        instructions.text = "Enter your database password to open the encrypted database."; 
        openButton.label = "Open Database"; 
    } 
    else 
    { 
        instructions.text = "Enter a password to create an encrypted database. The next time you open the application, you will need to re-enter the password to open the database again."; 
        openButton.label = "Create Database"; 
    } 
} 
     
function openConnection(event:MouseEvent):void 
{ 
    var keyGenerator:EncryptionKeyGenerator = new EncryptionKeyGenerator(); 
     
    var password:String = passwordInput.text; 
     
    if (password == null || password.length &lt;= 0) 
    { 
        statusMsg.text = "Please specify a password."; 
        return; 
    } 
     
    if (!keyGenerator.validateStrongPassword(password)) 
    { 
        statusMsg.text = "The password must be 8-32 characters long. It must contain at least one lowercase letter, at least one uppercase letter, and at least one number or symbol."; 
        return; 
    } 
     
    passwordInput.text = ""; 
    passwordInput.enabled = false; 
    openButton.enabled = false; 
     
    var encryptionKey:ByteArray = keyGenerator.getEncryptionKey(password); 
     
    conn.addEventListener(SQLEvent.OPEN, openHandler); 
    conn.addEventListener(SQLErrorEvent.ERROR, openError); 
     
    conn.openAsync(dbFile, SQLMode.CREATE, null, false, 1024, encryptionKey); 
} 
     
function openHandler(event:SQLEvent):void 
{ 
    conn.removeEventListener(SQLEvent.OPEN, openHandler); 
    conn.removeEventListener(SQLErrorEvent.ERROR, openError); 
     
    statusMsg.setStyle("textFormat", new TextFormat(null, null, 0x009900)); 
    if (createNewDB) 
    { 
        statusMsg.text = "The encrypted database was created successfully."; 
    } 
    else 
    { 
        statusMsg.text = "The encrypted database was opened successfully."; 
    } 
} 
 
function openError(event:SQLErrorEvent):void 
{ 
    conn.removeEventListener(SQLEvent.OPEN, openHandler); 
    conn.removeEventListener(SQLErrorEvent.ERROR, openError); 
     
    if (!createNewDB &amp;&amp; event.error.errorID == EncryptionKeyGenerator.ENCRYPTED_DB_PASSWORD_ERROR_ID) 
    { 
        statusMsg.text = "Incorrect password!"; 
    } 
    else 
    { 
        statusMsg.text = "Error creating or opening database."; 
    } 
}</pre>
             </div>
            </div>
           </div>
           <div class="nochunk" id="WS495D91DF-659A-4a6f-8944-EA08072C2D4C">
            <a name="WS495D91DF-659A-4a6f-8944-EA08072C2D4C">
             <!-- -->
            </a>
            <h3 class="topictitle3">
             Understanding the EncryptionKeyGenerator class
            </h3>
            <div>
             <p>
              It isn’t necessary to understand the inner workings of the EncryptionKeyGenerator
class to use it to create a secure encryption key for your application database.
The process for using the class is explained in
              <a href="WS44EC31A7-61B1-4e0a-8C61-D720AA95DE03.html">
               Using the EncryptionKeyGenerator class to obtain a secure encryption key
              </a>
              .
However, you might find it valuable to understand the techniques
that the class uses. For example, you might want to adapt the class
or incorporate some of its techniques for situations where a different
level of data privacy is desired.
             </p>
             <p>
              The EncryptionKeyGenerator class is included in the open-source
ActionScript 3.0 core library (as3corelib) project. You can download
              <a href="http://www.adobe.com/go/learn_air_opensource_encryptionkey" target="_self">
               the as3corelib package including source code
and documentation
              </a>
              .You can also view the source code on the
project site or download it to follow along with the explanations.
             </p>
             <p>
              When code creates an EncryptionKeyGenerator instance and calls
its
              <samp class="codeph">
               getEncryptionKey()
              </samp>
              method, several steps are
taken to ensure that only the rightful user can access the data.
The process is the same to generate an encryption key from a user-entered
password before the database is created as well as to re-create
the encryption key to open the database.
             </p>
            </div>
            <div class="nochunk" id="WSE01C3A40-C022-4820-95FA-34D3B15654AE">
             <a name="WSE01C3A40-C022-4820-95FA-34D3B15654AE">
              <!-- -->
             </a>
             <h4 class="topictitle4">
              Obtain and validate a strong password
             </h4>
             <div>
              <p>
               When code calls the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method,
it passes in a password as a parameter. The password is used as
the basis for the encryption key. By using a piece of information
that only the user knows, this design ensures that only the user
who knows the password can access the data in the database. Even
if an attacker accesses the user’s account on the computer, the
attacker can’t get into the database without knowing the password.
For maximum security, the application never stores the password.
              </p>
              <p>
               An application’s code creates an EncryptionKeyGenerator instance
and calls its
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method, passing
a user-entered password as an argument (the variable
               <samp class="codeph">
                password
               </samp>
               in
this example):
              </p>
              <pre>var keyGenerator:EncryptionKeyGenerator = new EncryptionKeyGenerator(); 
var encryptionKey:ByteArray = keyGenerator.getEncryptionKey(password);</pre>
              <p>
               The first step the EncryptionKeyGenerator class takes when the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method
is called is to check the user-entered password to ensure that it
meets the password strength requirements. The EncryptionKeyGenerator
class requires a password to be 8 - 32 characters long. The password
must contain a mix of uppercase and lowercase letters and at least one
number or symbol character.
              </p>
              <p>
               The
regular expression that checks this pattern is defined as a constant
named
               <samp class="codeph">
                STRONG_PASSWORD_PATTERN
               </samp>
               :
              </p>
              <pre>private static const STRONG_PASSWORD_PATTERN:RegExp = /(?=^.{8,32}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/;</pre>
              <p>
               The
code that checks the password is in the EncryptionKeyGenerator class’s
               <samp class="codeph">
                validateStrongPassword()
               </samp>
               method.
The code is as follows:
              </p>
              <pre>public function vaidateStrongPassword(password:String):Boolean 
{ 
    if (password == null || password.length &lt;= 0) 
    { 
        return false; 
    } 
     
    return STRONG_PASSWORD_PATTERN.test(password)) 
}</pre>
              <p>
               Internally the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method calls
the EncryptionKeyGenerator class’s
               <samp class="codeph">
                validateStrongPassword()
               </samp>
               method
and, if the password isn’t valid, throws an exception. The
               <samp class="codeph">
                validateStrongPassword()
               </samp>
               method is
a public method so that application code can check a password without
calling the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method to avoid
causing an error.
              </p>
             </div>
            </div>
            <div class="nochunk" id="WS2DC7AA20-EA16-42d0-96A4-917B0F2BE1B0">
             <a name="WS2DC7AA20-EA16-42d0-96A4-917B0F2BE1B0">
              <!-- -->
             </a>
             <h4 class="topictitle4">
              Expand the password to 256 bits
             </h4>
             <div>
              <p>
               Later in the process, the password is required to be 256 bits
long. Rather than require each user to enter a password that’s exactly
256 bits (32 characters) long, the code creates a longer password
by repeating the password characters.
              </p>
              <p>
               The
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method
calls the
               <samp class="codeph">
                concatenatePassword()
               </samp>
               method to perform
the task of creating the long password.
              </p>
              <pre>var concatenatedPassword:String = concatenatePassword(password);</pre>
              <p>
               The following is the code for the
               <samp class="codeph">
                concatenatePassword()
               </samp>
               method:
              </p>
              <pre>private function concatenatePassword(pwd:String):String 
{ 
    var len:int = pwd.length; 
    var targetLength:int = 32; 
     
    if (len == targetLength) 
    { 
        return pwd; 
    } 
     
    var repetitions:int = Math.floor(targetLength / len); 
    var excess:int = targetLength % len; 
     
    var result:String = ""; 
     
    for (var i:uint = 0; i &lt; repetitions; i++) 
    { 
        result += pwd; 
    } 
     
    result += pwd.substr(0, excess); 
     
    return result; 
}</pre>
              <p>
               If the password is less than 256 bits, the code concatenates
the password with itself to make it 256 bits. If the length doesn’t
work out exactly, the last repetition is shortened to get exactly
256 bits.
              </p>
             </div>
            </div>
            <div class="nochunk" id="WSEDEE3767-B59B-4f9b-8D70-F36EFC0F07D3">
             <a name="WSEDEE3767-B59B-4f9b-8D70-F36EFC0F07D3">
              <!-- -->
             </a>
             <h4 class="topictitle4">
              Generate or retrieve a 256-bit salt value
             </h4>
             <div>
              <p>
               The next step is to get a 256-bit salt value that in a later
step is combined with the password. A
               <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">
                salt
               </i>
               is a random value
that is added to or combined with a user-entered value to form a
password. Using a salt with a password ensures that even if a user
chooses a real word or common term as a password, the password-plus-salt
combination that the system uses is a random value. This randomness
helps guard against a dictionary attack, where an attacker uses
a list of words to attempt to guess a password. In addition, by
generating the salt value and storing it in the encrypted local
store, it is tied to the user’s account on the machine on which
the database file is located.
              </p>
              <p>
               If the application is calling the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method
for the first time, the code creates a random 256-bit salt value.
Otherwise, the code loads the salt value from the encrypted local
store.
              </p>
              <p>
               The
salt is stored in a variable named
               <samp class="codeph">
                salt
               </samp>
               . The code
determines if it has already created a salt by attempting to load
the salt from the encrypted local store:
              </p>
              <pre>var salt:ByteArray = EncryptedLocalStore.getItem(saltKey); 
if (salt == null) 
{ 
    salt = makeSalt(); 
    EncryptedLocalStore.setItem(saltKey, salt); 
}</pre>
              <p>
               If
the code is creating a new salt value, the
               <samp class="codeph">
                makeSalt()
               </samp>
               method
generates a 256-bit random value. Because the value is eventually
stored in the encrypted local store, it is generated as a ByteArray object.
The
               <samp class="codeph">
                makeSalt()
               </samp>
               method uses the
               <samp class="codeph">
                Math.random()
               </samp>
               method
to randomly generate the value. The
               <samp class="codeph">
                Math.random()
               </samp>
               method
can’t generate 256 bits at one time. Instead, the code uses a loop
to call
               <samp class="codeph">
                Math.random()
               </samp>
               eight times. Each time, a
random uint value between 0 and 4294967295 (the maximum uint value)
is generated. A uint value is used for convenience, because a uint
uses exactly 32 bits. By writing eight uint values into the ByteArray,
a 256-bit value is generated. The following is the code for the
               <samp class="codeph">
                makeSalt()
               </samp>
               method:
              </p>
              <pre>private function makeSalt():ByteArray 
{ 
    var result:ByteArray = new ByteArray; 
     
    for (var i:uint = 0; i &lt; 8; i++) 
    { 
        result.writeUnsignedInt(Math.round(Math.random() * uint.MAX_VALUE)); 
    } 
     
    return result; 
}</pre>
              <p>
               When
the code is saving the salt to the Encrypted Local Store (ELS) or
retrieving the salt from the ELS, it needs a String key under which
the salt is saved. Without knowing the key, the salt value can’t
be retrieved. In that case, the encryption key can’t be re-created
each time to reopen the database. By default, the EncryptionKeyGenerator
uses a predefined ELS key that is defined in the constant
               <samp class="codeph">
                SALT_ELS_KEY
               </samp>
               .
Instead of using the default key, application code can also specify
an ELS key to use in the call to the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method.
Either the default or the application-specified salt ELS key is
stored in a variable named
               <samp class="codeph">
                saltKey
               </samp>
               . That variable
is used in the calls to
               <samp class="codeph">
                EncryptedLocalStore.setItem()
               </samp>
               and
               <samp class="codeph">
                EncryptedLocalStore.getItem()
               </samp>
               ,
as shown previously.
              </p>
             </div>
            </div>
            <div class="nochunk" id="WS352D1548-645D-4ec1-8CE5-BFB375571C29">
             <a name="WS352D1548-645D-4ec1-8CE5-BFB375571C29">
              <!-- -->
             </a>
             <h4 class="topictitle4">
              Combine the 256-bit password and salt using the XOR operator
             </h4>
             <div>
              <p>
               The code now has a 256-bit password and a 256-bit salt value.
It next uses a bitwise XOR operation to combine the salt and the
concatenated password into a single value. In effect, this technique
creates a 256-bit password consisting of characters from the entire
range of possible characters. This principle is true even though
most likely the actual password input consists of primarily alphanumeric characters.
This increased randomness provides the benefit of making the set
of possible passwords large without requiring the user to enter
a long complex password.
              </p>
              <p>
               The
result of the XOR operation is stored in the variable
               <samp class="codeph">
                unhashedKey
               </samp>
               .
The actual process of performing a bitwise XOR on the two values
happens in the
               <samp class="codeph">
                xorBytes()
               </samp>
               method:
              </p>
              <pre>var unhashedKey:ByteArray = xorBytes(concatenatedPassword, salt);</pre>
              <p>
               The
bitwise XOR operator (
               <samp class="codeph">
                ^
               </samp>
               ) takes two uint values and
returns a uint value. (A uint value contains 32 bits.) The input
values passed as arguments to the
               <samp class="codeph">
                xorBytes()
               </samp>
               method
are a String (the password) and a ByteArray (the salt). Consequently,
the code uses a loop to extract 32 bits at a time from each input
to combine using the XOR operator.
              </p>
              <pre>private function xorBytes(passwordString:String, salt:ByteArray):ByteArray 
{ 
    var result:ByteArray = new ByteArray(); 
     
    for (var i:uint = 0; i &lt; 32; i += 4) 
    { 
        // ... 
    } 
     
    return result; 
}</pre>
              <p>
               Within
the loop, first 32 bits (4 bytes) are extracted from the
               <samp class="codeph">
                passwordString
               </samp>
               parameter.
Those bits are extracted and converted into a uint (
               <samp class="codeph">
                o1
               </samp>
               )
in a two-part process. First, the
               <samp class="codeph">
                charCodeAt()
               </samp>
               method
gets each character’s numeric value. Next, that value is shifted
to the appropriate position in the uint using the bitwise left shift
operator (
               <samp class="codeph">
                &lt;&lt;
               </samp>
               ) and the shifted value is added
to
               <samp class="codeph">
                o1
               </samp>
               . For example, the first character (
               <samp class="codeph">
                i
               </samp>
               )
becomes the first 8 bits by using the bitwise left shift operator
(
               <samp class="codeph">
                &lt;&lt;
               </samp>
               ) to shift the bits left by 24 bits and assigning
that value to
               <samp class="codeph">
                o1
               </samp>
               . The second character
               <samp class="codeph">
                (i + 1
               </samp>
               )
becomes the second 8 bits by shifting its value left 16 bits and
adding the result to
               <samp class="codeph">
                o1
               </samp>
               . The third and fourth characters’
values are added the same way.
              </p>
              <pre>        // ... 
         
        // Extract 4 bytes from the password string and convert to a uint 
        var o1:uint = passwordString.charCodeAt(i) &lt;&lt; 24; 
        o1 += passwordString.charCodeAt(i + 1) &lt;&lt; 16; 
        o1 += passwordString.charCodeAt(i + 2) &lt;&lt; 8; 
        o1 += passwordString.charCodeAt(i + 3); 
         
        // ...</pre>
              <p>
               The
variable
               <samp class="codeph">
                o1
               </samp>
               now contains 32 bits from the
               <samp class="codeph">
                passwordString
               </samp>
               parameter.
Next, 32 bits are extracted from the
               <samp class="codeph">
                salt
               </samp>
               parameter
by calling its
               <samp class="codeph">
                readUnsignedInt()
               </samp>
               method. The 32
bits are stored in the uint variable
               <samp class="codeph">
                o2
               </samp>
               .
              </p>
              <pre>        // ... 
         
        salt.position = i; 
        var o2:uint = salt.readUnsignedInt(); 
         
        // ...</pre>
              <p>
               Finally,
the two 32-bit (uint) values are combined using the XOR operator
and the result is written into a ByteArray named
               <samp class="codeph">
                result
               </samp>
               .
              </p>
              <pre>        // ... 
         
        var xor:uint = o1 ^ o2; 
        result.writeUnsignedInt(xor); 
        // ...</pre>
              <p>
               Once
the loop completes, the ByteArray containing the XOR result is returned.
              </p>
              <pre>        // ... 
    } 
     
    return result; 
}</pre>
             </div>
            </div>
            <div class="nochunk" id="WSEC3CAF33-DE87-4119-ABA7-0E618AFC1D05">
             <a name="WSEC3CAF33-DE87-4119-ABA7-0E618AFC1D05">
              <!-- -->
             </a>
             <h4 class="topictitle4">
              Hash the key
             </h4>
             <div>
              <p>
               Once the concatenated password and the salt have been combined,
the next step is to further secure this value by hashing it using
the SHA-256 hashing algorithm. Hashing the value makes it more difficult
for an attacker to reverse-engineer it.
              </p>
              <p>
               At
this point the code has a ByteArray named
               <samp class="codeph">
                unhashedKey
               </samp>
               containing
the concatenated password combined with the salt. The ActionScript
3.0 core library (as3corelib) project includes a SHA256 class in the
com.adobe.crypto package. The
               <samp class="codeph">
                SHA256.hashBytes()
               </samp>
               method
that performs a SHA-256 hash on a ByteArray and returns a String
containing the 256-bit hash result as a hexadecimal number. The
EncryptionKeyGenerator class uses the SHA256 class to hash the key:
              </p>
              <pre>var hashedKey:String = SHA256.hashBytes(unhashedKey);</pre>
             </div>
            </div>
            <div class="nochunk" id="WS201AE506-5799-426e-ADE9-5EBFE0458D59">
             <a name="WS201AE506-5799-426e-ADE9-5EBFE0458D59">
              <!-- -->
             </a>
             <h4 class="topictitle4">
              Extract the encryption key from the hash
             </h4>
             <div>
              <p>
               The encryption key must be a ByteArray that is exactly 16 bytes
(128 bits) long. The result of the SHA-256 hashing algorithm is
always 256 bits long. Consequently, the final step is to select
128 bits from the hashed result to use as the actual encryption
key.
              </p>
              <p>
               In
the EncryptionKeyGenerator class, the code reduces the key to 128
bits by calling the
               <samp class="codeph">
                generateEncryptionKey()
               </samp>
               method.
It then returns that method’s result as the result of the
               <samp class="codeph">
                getEncryptionKey()
               </samp>
               method:
              </p>
              <pre>var encryptionKey:ByteArray = generateEncryptionKey(hashedKey); 
return encryptionKey;</pre>
              <p>
               It isn’t necessary to use the first 128 bits as the encryption
key. You could select a range of bits starting at some arbitrary
point, you could select every other bit, or use some other way of
selecting bits. The important thing is that the code selects 128
distinct bits, and that the same 128 bits are used each time.
              </p>
              <p>
               In
this case, the
               <samp class="codeph">
                generateEncryptionKey()
               </samp>
               method uses
the range of bits starting at the 18th byte as the encryption key.
As mentioned previously, the SHA256 class returns a String containing
a 256-bit hash as a hexadecimal number. A single block of 128 bits
has too many bytes to add to a ByteArray at one time. Consequently,
the code uses a
               <samp class="codeph">
                for
               </samp>
               loop to extract characters
from the hexadecimal String, convert them to actual numeric values, and
add them to the ByteArray. The SHA-256 result String is 64 characters
long. A range of 128 bits equals 32 characters in the String, and
each character represents 4 bits. The smallest increment of data
you can add to a ByteArray is one byte (8 bits), which is equivalent
to two characters in the
               <samp class="codeph">
                hash
               </samp>
               String. Consequently, the
loop counts from 0 to 31 (32 characters) in increments of 2 characters.
              </p>
              <p>
               Within
the loop, the code first determines the starting position for the
current pair of characters. Since the desired range starts at the
character at index position 17 (the 18th byte), the
               <samp class="codeph">
                position
               </samp>
               variable
is assigned the current iterator value (
               <samp class="codeph">
                i
               </samp>
               ) plus
17. The code uses the String object’s
               <samp class="codeph">
                substr()
               </samp>
               method
to extract the two characters at the current position. Those characters
are stored in the variable
               <samp class="codeph">
                hex
               </samp>
               . Next, the code
uses the
               <samp class="codeph">
                parseInt()
               </samp>
               method to convert the
               <samp class="codeph">
                hex
               </samp>
               String
to a decimal integer value. It stores that value in the int variable
               <samp class="codeph">
                byte
               </samp>
               .
Finally, the code adds the value in
               <samp class="codeph">
                byte
               </samp>
               to the
               <samp class="codeph">
                result
               </samp>
               ByteArray
using its
               <samp class="codeph">
                writeByte()
               </samp>
               method. When the loop finishes,
the
               <samp class="codeph">
                result
               </samp>
               ByteArray contains 16 bytes and is ready
to use as a database encryption key.
              </p>
              <pre>private function generateEncryptionKey(hash:String):ByteArray 
{ 
    var result:ByteArray = new ByteArray(); 
     
    for (var i:uint = 0; i &lt; 32; i += 2) 
    { 
        var position:uint = i + 17; 
        var hex:String = hash.substr(position, 2); 
        var byte:int = parseInt(hex, 16); 
        result.writeByte(byte); 
    } 
     
    return result; 
}</pre>
             </div>
            </div>
           </div>
          </div>
          <!-- BEGIN USER PREFERENCES -->
          <div id="userprefs">
          </div>
          <!-- END USER PREFERENCES -->
          <div id="related">
           <div class="separator">
            <a href="#top">
             <img src="images/BTT.jpg"/>
            </a>
           </div>
          </div>
          <div id="footer">
           <!-- BEGIN IONCOMMENTS -->
           <div id="ionComHere">
           </div>
           <!-- END IONCOMMENTS -->
           

           <p id="creativecommons">
            <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" id="creativecommons_text">
             <img alt="This work is licensed under a Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License" id="creativecommons_img" src="images/CC.png"/>
            </a>
            Twitter™ and Facebook posts are not covered under the terms of Creative Commons.
           </p>
          </div>
         </td>
         <td width="10px">
         </td>
         <td id="inner_rightcolumn">
          
         </td>
        </tr>
       </table>
      </div>
      <!-- BEGIN BREADCRUMBS -->
      <div id="breadcrumb">
       <ul class="navigation">
        <li class="prev">
         <a accesskey="p" class="prev" href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d2b.html" title="Understanding the asynchronous execution model">
          <img alt="Previous" height="17" src="images/blank.gif" width="17"/>
         </a>
        </li>
        <li class="next">
         <a accesskey="n" class="next" href="WS5b3ccc516d4fbf351e63e3d118666ade46-7d25.html" title="Strategies for working with SQL databases">
          <img alt="Next" height="17" src="images/blank.gif" width="17"/>
         </a>
        </li>
       </ul>
       <div class="hierarchy" id="hierarchy">
        <a href="WS9936fa0d5984e93b3f4f38ec1272a447844-8000.html">
         <b>
          Home
         </b>
        </a>
        /
        <a href="WS9936fa0d5984e93b3f4f38ec1272a447844-8000.html">
         <b>
          ActionScript 3.0 Developer’s Guide
         </b>
        </a>
        /
        <a href="WSd75bf4610ec9e22f-26f30d3c12213ec4d50-8000.html">
         <b>
          Files and data
         </b>
        </a>
        /
        <a href="WS5b3ccc516d4fbf351e63e3d118676a5497-7fb4.html">
         <b>
          Working with local SQL databases in AIR
         </b>
        </a>
       </div>
      </div>
      <!-- END BREADCRUMBS -->
      <!-- END CONTENT WRAPPER -->
      
     </td>
     <td id="col3">
      <div>
       <img src="images/adobe-lq.png"/>
      </div>
     </td>
    </tr>
   </table>
  </div>
  <!-- END PAGE CONTENT WRAPPER -->
  <script type="text/javascript">
   <!--[CDATA[
scrollToNameAnchor();
// ]]-->
  </script>
  <!--
    Description:
    This file generates the link to product support in the top right corner
-->

<style>
#menutop{
    position:absolute;
    top:4px;
    right:24px;
    width:auto;    
    font-size:11px;
    color:#fff;
    text-align:right;
}
#menutop a{
    color:#fff;
}
#menutop a:hover{
        text-decoration:underline;
}
</style>  
  
  
  
  
<div id="productmenu">
<!--googleoff: index-->
  <div id="menutop">


<script language=javascript type='text/javascript'>
    // darken menu text for products with light backgrounds
    var path = document.location.href.toLowerCase();
    if (path.indexOf("/acrobat/")           	> 0 ||
        path.indexOf("/acrobat.com/")       	> 0 ||
        path.indexOf("/acrobatConnectPro/") 	> 0 ||
        path.indexOf("/connect/")           	> 0 ||
        path.indexOf("/framemaker/")           	> 0 ||
        path.indexOf("/livecycledataserviceses/") > 0 ||
        path.indexOf("/muse/")         	> 0 ||
		path.indexOf("/presenter/")         	> 0 ||
        path.indexOf("/scene7/")            	> 0 ||
        path.indexOf("/flashmediaserver/")  	> 0 ||
        path.indexOf("/wave/")              	> 0 )
    {
        document.write('<style>#menutop a{color:#505050}</style>');
    }
    if (typeof('terms_AHV_PRODUCT_SUPPORT') != "undefined" && ! use_robohelp_behavior ){      
        if (path.indexOf("/muse/") > -1 ){
            var supportlink = '<a href="http://muse.adobe.com/support.html">'+terms_AHV_PRODUCT_SUPPORT+'</a>';
        }else{
            var supportlink = '<a href="http://adobe.com/support">'+terms_AHV_PRODUCT_SUPPORT+'</a>';
        }
        document.write( supportlink );
     }

</script> 

  </div>
<!--googleon: index-->
</div>



  <style>
#online-privacy-policy{ 
    margin:10px 40px; 
    font-size:11px;
}
</style>

<p id="online-privacy-policy">
<script language="javascript">
var pageLoc = "en_US";
var metaElements = document.all ?
document.all.tags('meta') :
document.getElementsByTagName ?
document.getElementsByTagName ('meta') : new Array();
for (var m = 0; m < metaElements.length; m++) {
	if (metaElements[m].name == "lang") {
		pageLoc = metaElements[m].content;
		break;
	}
}
var ptn = /(..)-(..)/;
if (ptn.test(pageLoc)) {
	var languageCode = pageLoc.replace(ptn, "$1");
	var countryCode = pageLoc.replace(ptn, "$2");
	pageLoc = languageCode + "_" + countryCode.toUpperCase();
}

var policyLoc = "en_US";
var policyText = "Online Privacy Policy";
var policyPath = "";
var policyArray=[
"da_DK", "Online fortrolighedserklæring",
"de_DE", "Online-Datenschutzrichtlinie",
"es_ES", "Política de confidencialidad en línea",
"fi_FI", "Yksityisyyttä koskeva Online-toimintaohjelma",
"fr_FR", "Confidentialité et sécurité",
"it_IT", "Informativa sulla privacy online",
"ja_JP", "プライバシーポリシー",
"ko_KR", "Adobe 온라인 개인정보 보호정책",
"pt_BR", "Política de Confidencialidade On-line", 
"zh_CN", "在线隐私政策",
"zh_TW", "線上隱私政策"
];
var legalLoc = "en_US";
var legalText = "Legal Notices";
var legalPath = legalLoc;
var legalArray=[
"ar_AE", "إشعارات قانونية",
"bg_BG", "Юридически бележки",
"cs_CZ", "Právní upozornění",
"da_DK", "Juridiske meddelelser",
"de_DE", "Rechtliche Hinweise",
"el_GR", "Σημειώσεις νομικού περιεχομένου",
"es_ES", "Avisos legales",
"et_EE", "Juriidilised teated",
"fi_FI", "Lakisääteiset ilmoitukset",
"fr_FR", "Mentions légales",
"he_IL", "הצהרות משפטיות",
"hr_HR", "Pravne napomene",
"hu_HU", "Jogi közlemények",
"it_IT", "Informazioni legali",
"ja_JP", "法律上の注意",
"ko_KR", "법적 고지 사항",
"lt_LT", "Teisinės pastabos",
"lv_LV", "Juridisks paziņojums",
"nb_NO", "Juridiske merknader",
"nl_NL", "Juridische kennisgevingen",
"pl_PL", "Informacje prawne",
"pt_BR", "Aspectos jurídicos",
"ro_RO", "Prevederi legale",
"ru_RU", "Юридическая информация",
"sk_SK", "Právne upozornenie",
"sl_SI", "Pravni pouk",
"sv_SE", "Upphovsrätt",
"tr_TR", "Yasal uyarılar",
"uk_UA", "Юридична інформація",
"zh_CN", "法律声明",
"zh_TW", "法律注意事項"
];

ruPolicy = "http://www.adobe.com/ru/misc/privacy.html";
trPolicy = "http://www.adobe.com/tr/misc/privacy.html";

// Bug 2846992: LOC: RUS, TUR: The link to "Online Privacy Policy" should include language, currently it is not appearing.
if (pageLoc == "ru_RU") {
	policyPath = "ru";
}
else if (pageLoc == "tr_TR") {
	policyPath = "tr";
}
for (var i = 0; i < policyArray.length; i+=2) {
	if (pageLoc == policyArray[i]) {
		policyLoc = pageLoc;
		policyText = policyArray[i+1];
		var ptn = /(..)_(..)/;
		if (ptn.test(policyLoc)) {
			var countryCode = policyLoc.replace(ptn, "$2");
			policyPath = countryCode.toLowerCase();
		}
		break;
	}
}

for (var i = 0; i < legalArray.length; i+=2) {
	if (pageLoc == legalArray[i]) {
		legalLoc = pageLoc;
		legalText = legalArray[i+1];
		legalPath = legalLoc;
		break;
	}
}
if(agt.indexOf("community help client") > -1 ){
	document.write('<a href="/'+legalPath+'/legalnotices/index.html">'+legalText+'<\/a>');
	document.write(' | ');
	document.write('<a href="http://www.adobe.com/'+policyPath+'/misc/privacy.html">'+policyText+'<\/a>');
}else{
	//Open the privacy policy in a new window
	document.write('<a target="_blank" href="/'+legalPath+'/legalnotices/index.html">'+legalText+'<\/a>');
	document.write(' | ');
	document.write('<a target="_blank" href="http://www.adobe.com/'+policyPath+'/misc/privacy.html">'+policyText+'<\/a>');
} 


remove_all_cookies();

function remove_all_cookies() {
	var res = document.cookie;
    var multiple = res.split(";");
    for(var i = 0; i < multiple.length; i++) {
    	var key = multiple[i].split("=");
        document.cookie = key[0]+" =; expires = Thu, 01 Jan 1970 00:00:00 UTC";
    }
}


</script>
</p>


  
<!-- localfooter.ssi -->

<script type="text/javascript">
    var debug = (top.location.href.indexOf("debug=true") > -1);
</script>

<script language="javascript">
document.write('<scr'+'ipt ' +
               'src="/en_US/ssi/_pod.js" ' +
               'language="javascript" ' +
               'charset="UTF-8"> ' +
               '</scr'+'ipt>');
</script>

//  Ethnio survey code removed
  
  
 </body>
</html>